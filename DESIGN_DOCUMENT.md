# Pomodoro Genie Flutter 应用设计文档

## 📋 项目概述

基于图片分析和用户需求，设计一个功能完整的番茄钟任务管理应用，包含项目管理、任务管理、番茄钟计时和统计功能。

## 🎯 核心功能需求

### 1. 项目管理功能

#### 1.1 新建项目
- **触发方式**: 点击左侧导航栏底部的 `+ Add Project` 按钮
- **输入内容**: 仅需要项目名称
- **交互方式**: 弹出模态框，输入项目名称后确认创建
- **UI位置**: 左侧导航栏项目列表底部

#### 1.2 修改项目名称
- **触发方式**: 在项目列表项上长按或点击"更多"图标
- **交互方式**: 弹出上下文菜单，选择"编辑项目"
- **编辑界面**: 模态框预填充当前项目名称，允许修改
- **确认方式**: 保存按钮确认修改

#### 1.3 删除项目
- **触发方式**: 项目上下文菜单中的"删除项目"选项
- **确认机制**: 二次确认对话框，防止误删
- **数据清理**: 删除项目时，其下的任务自动移动到"Tasks"（所有任务）分类

### 2. 项目与任务聚合

#### 2.1 项目筛选
- **筛选逻辑**: 点击左侧导航栏中的项目名称，主内容区立即更新显示该项目下的任务
- **默认视图**: `Tasks` 类别显示所有任务（跨项目聚合）
- **UI反馈**: 主内容区标题从 `Today` 变为 `[项目名称]` 来清晰区分当前显示的项目

#### 2.2 任务分配
- **创建任务时**: 提供项目选择下拉框，默认分配到当前激活的项目
- **编辑任务时**: 允许修改任务所属项目
- **未分配任务**: 自动归类到"Tasks"（所有任务）分类

### 3. 任务番茄钟功能

#### 3.1 番茄钟按钮
- **位置**: 每个任务项右侧的红色"播放"图标
- **功能**: 点击后立即启动该任务的番茄钟
- **状态**: 按钮状态根据番茄钟运行状态变化（播放/暂停图标）

#### 3.2 番茄钟页面
- **进入方式**: 点击任务番茄钟按钮后，导航到全屏番茄钟页面
- **页面内容**:
  - 大号计时器显示剩余时间
  - 当前任务名称和详细信息
  - 番茄钟类型指示（工作/短休息/长休息）
  - 控制按钮：开始、暂停、跳过休息、停止
  - 任务进度显示（已完成/计划番茄钟数）

### 4. 番茄钟缩小/放大功能

#### 4.1 迷你播放器（缩小状态）
- **位置**: 底部浮动窗口
- **内容**: 
  - 剩余时间（左侧）
  - 当前任务名称（中间）
  - 播放/暂停控制（右侧特定图标）
- **背景**: 深色圆角矩形，带抽象图案背景

#### 4.2 全屏番茄钟页面（放大状态）
- **进入方式**: 点击迷你播放器上的特定图标
- **退出方式**: 点击"缩小"或"返回"按钮
- **功能**: 番茄钟在后台继续计时，可随时切换

#### 4.3 状态同步
- **数据同步**: 迷你播放器和全屏页面状态实时同步
- **计时连续性**: 切换状态时番茄钟计时不中断

## 🎨 UI/UX 设计规范

### 1. 整体布局
- **左侧导航栏**: 固定宽度，包含用户信息、时间筛选、项目列表
- **主内容区**: 自适应宽度，显示任务列表和统计信息
- **底部迷你播放器**: 浮动窗口，仅在番茄钟运行时显示

### 2. 颜色规范
- **番茄钟按钮**: 红色圆形背景，白色播放图标
- **迷你播放器**: 深色背景（#2D2D2D），绿色抽象图案
- **项目激活状态**: 高亮显示当前选中的项目
- **任务完成状态**: 灰色文字，删除线效果

### 3. 交互反馈
- **按钮点击**: 轻微缩放动画
- **状态切换**: 平滑过渡动画
- **加载状态**: 骨架屏或加载指示器

## 📱 页面结构

### 1. 主页面布局
```
┌─────────────────────────────────────────────────────────┐
│ 左侧导航栏          │ 主内容区                           │
│ ┌─────────────────┐ │ ┌─────────────────────────────────┐ │
│ │ 用户信息         │ │ │ 统计卡片区域                    │ │
│ │ Today (0m 5)     │ │ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │ │
│ │ Tomorrow (0m 0)  │ │ │ │ 0m  │ │ 5   │ │ 0m  │ │ 0   │ │ │
│ │ This Week (0m 0) │ │ │ │ Est │ │ Tas │ │ Ela │ │ Com │ │ │
│ │ Planned (0m 5)   │ │ │ │ Time│ │ ks  │ │ psed│ │ plet│ │ │
│ │ Completed        │ │ │ └─────┘ └─────┘ └─────┘ └─────┘ │ │
│ │ Tasks (0m 5)     │ │ └─────────────────────────────────┘ │
│ │ project1 (0m 0)  │ │ ┌─────────────────────────────────┐ │
│ │ + Add Project    │ │ │ 任务输入框                       │ │
│ └─────────────────┘ │ └─────────────────────────────────┘ │
│                     │ ┌─────────────────────────────────┐ │
│                     │ │ 任务列表                         │ │
│                     │ │ ○ ▶ bazel        [4🍅] 1 Oct    │ │
│                     │ │ ○ ▶ genie       [0🍅] 12 Sep   │ │
│                     │ │ ○ ▶ teleport审计 [0🍅] 15 Sep   │ │
│                     │ └─────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────┐
│ 底部迷你播放器（仅在番茄钟运行时显示）                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 25    bazel    ▶                                    │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 2. 全屏番茄钟页面
```
┌─────────────────────────────────────────────────────────┐
│ ← 缩小按钮                   番茄钟页面                   │
│                                                         │
│                     ┌─────────────┐                     │
│                     │             │                     │
│                     │     25:00   │                     │
│                     │             │                     │
│                     └─────────────┘                     │
│                                                         │
│                     bazel                                │
│                     任务描述信息...                       │
│                                                         │
│              ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐             │
│              │ 开始 │ │ 暂停 │ │ 跳过 │ │ 停止 │             │
│              └─────┘ └─────┘ └─────┘ └─────┘             │
│                                                         │
│              进度: 2/4 番茄钟                             │
└─────────────────────────────────────────────────────────┘
```

## 🔧 技术实现要点

### 1. 状态管理
- **Riverpod**: 使用 StateNotifierProvider 管理项目、任务、番茄钟状态
- **数据持久化**: SharedPreferences 保存用户数据
- **状态同步**: 迷你播放器和全屏页面共享同一个状态

### 2. 导航管理
- **页面路由**: 使用 Flutter 内置导航或 go_router
- **状态保持**: 番茄钟状态在页面切换时保持
- **返回处理**: 全屏番茄钟页面的返回按钮处理

### 3. 计时器实现
- **Timer**: 使用 Dart Timer 实现精确计时
- **后台运行**: 应用切换到后台时继续计时
- **状态恢复**: 应用重新激活时恢复计时状态

## ❓ 需要进一步确认的问题

1. **番茄钟时长设置**: 工作、短休息、长休息的默认时长是多少？
2. **番茄钟循环**: 是否需要自动进入休息时间，还是手动控制？
3. **任务优先级**: 是否需要任务优先级功能，如何显示？
4. **截止日期**: 任务是否需要截止日期功能？
5. **统计功能**: 需要哪些统计信息（日、周、月统计）？
6. **通知功能**: 番茄钟结束时是否需要通知提醒？
7. **数据同步**: 是否需要云端同步功能？
8. **主题切换**: 是否需要深色/浅色主题切换？

## 📋 开发优先级

### Phase 1: 核心功能
1. 项目CRUD功能
2. 项目任务筛选
3. 基础番茄钟功能

### Phase 2: 增强功能
1. 番茄钟缩小/放大
2. 任务详情显示
3. 统计功能

### Phase 3: 完善功能
1. 通知系统
2. 主题系统
3. 设置管理

---

请确认以上设计是否符合你的需求，并回答需要进一步确认的问题。
