---
appId: com.pomodoro.genie
name: Pomodoro Timer Flow E2E Tests
tags:
  - pomodoro
  - timer
  - sessions

---
# Test: Basic Pomodoro Session
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to timer screen
- tapOn: "Timer"
- assertVisible: "Pomodoro Timer"
- assertVisible: "25:00"

# Verify initial state
- assertVisible: "Select a task to start"
- assertVisible: "Start"

# Select a task
- tapOn: "Select Task"
- assertVisible: "Choose a Task"
- tapOn: "Complete project documentation - Updated"
- assertVisible: "Complete project documentation - Updated"

# Start pomodoro session
- tapOn: "Start"
- assertVisible: "24:59"
- assertVisible: "Pause"
- assertVisible: "Stop"

# Verify timer is running (wait and check time change)
- wait: 2000
- assertVisible: "24:58"

---
# Test: Pause and Resume Timer
- runFlow:
    file: shared/setup_authenticated.yaml

# Start a timer session
- tapOn: "Timer"
- tapOn: "Select Task"
- tapOn: "Complete project documentation - Updated"
- tapOn: "Start"

# Pause the timer
- wait: 3000
- tapOn: "Pause"
- assertVisible: "Resume"
- assertVisible: "Stop"

# Verify timer is paused (time shouldn't change)
- wait: 2000
- assertVisible: "24:57" # Should remain the same

# Resume the timer
- tapOn: "Resume"
- assertVisible: "Pause"
- wait: 2000
- assertVisible: "24:56" # Should continue counting

---
# Test: Stop Timer Early
- runFlow:
    file: shared/setup_authenticated.yaml

# Start a timer session
- tapOn: "Timer"
- tapOn: "Select Task"
- tapOn: "Complete project documentation - Updated"
- tapOn: "Start"

# Stop the timer early
- wait: 5000
- tapOn: "Stop"
- assertVisible: "Stop Session"
- assertVisible: "Are you sure you want to stop the current session?"

# Cancel stop action
- tapOn: "Cancel"
- assertVisible: "Pause"

# Actually stop the timer
- tapOn: "Stop"
- tapOn: "Confirm"
- assertVisible: "Session stopped"
- assertVisible: "25:00" # Should reset
- assertVisible: "Start"

---
# Test: Complete Pomodoro Session
- runFlow:
    file: shared/setup_authenticated.yaml

# Start a timer session
- tapOn: "Timer"
- tapOn: "Select Task"
- tapOn: "Complete project documentation - Updated"

# Set timer to a short duration for testing (if setting available)
- tapOn:
    id: "timer_settings"
  optional: true
- tapOn: "Work Duration"
  optional: true
- clearText:
    id: "duration_field"
  optional: true
- inputText: "0.1" # 6 seconds for testing
  optional: true
- tapOn: "Save"
  optional: true

- tapOn: "Start"

# Wait for session to complete (using short duration)
- wait: 7000

# Verify completion
- assertVisible: "Session Complete!"
- assertVisible: "Great job!"
- assertVisible: "Start Break"

# Start break session
- tapOn: "Start Break"
- assertVisible: "Break Time"
- assertVisible: "05:00" # Default break duration

---
# Test: Session Statistics
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to timer screen
- tapOn: "Timer"

# Check today's statistics
- assertVisible: "Today's Progress"
- assertVisible: "Pomodoros: 0"
- assertVisible: "Focus Time: 0h 0m"

# Start and complete a session (using short duration)
- tapOn: "Select Task"
- tapOn: "Complete project documentation - Updated"
- tapOn: "Start"
- wait: 7000 # Wait for completion

# Check updated statistics
- assertVisible: "Pomodoros: 1"
- assertVisible: "Focus Time: 0h 1m"

---
# Test: Timer Settings
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to timer screen
- tapOn: "Timer"
- tapOn:
    id: "timer_settings"

# Verify settings options
- assertVisible: "Timer Settings"
- assertVisible: "Work Duration"
- assertVisible: "Short Break Duration"
- assertVisible: "Long Break Duration"
- assertVisible: "Sessions Until Long Break"

# Modify work duration
- tapOn: "Work Duration"
- clearText:
    id: "duration_field"
- inputText: "30"
- tapOn: "Save"

# Verify change is applied
- assertVisible: "30:00"

# Modify break durations
- tapOn:
    id: "timer_settings"
- tapOn: "Short Break Duration"
- clearText:
    id: "duration_field"
- inputText: "7"
- tapOn: "Save"

- tapOn:
    id: "timer_settings"
- tapOn: "Long Break Duration"
- clearText:
    id: "duration_field"
- inputText: "20"
- tapOn: "Save"

# Reset to defaults
- tapOn:
    id: "timer_settings"
- tapOn: "Reset to Defaults"
- tapOn: "Confirm"
- assertVisible: "25:00"

---
# Test: Background Timer Notifications
- runFlow:
    file: shared/setup_authenticated.yaml

# Start a timer session
- tapOn: "Timer"
- tapOn: "Select Task"
- tapOn: "Complete project documentation - Updated"
- tapOn: "Start"

# Minimize app (go to background)
- pressKey: "Home"
- wait: 5000

# Return to app
- launchApp
- wait: 2000

# Verify timer continued running in background
- assertVisible: "24:55" # Should show elapsed time

# Test notification permissions (if prompt appears)
- tapOn: "Allow"
  optional: true

---
# Test: Timer Session History
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to timer screen
- tapOn: "Timer"

# Access session history
- tapOn:
    id: "session_history"
- assertVisible: "Session History"

# Should show completed sessions
- assertVisible: "Today"
- assertVisible: "Work Session"
- assertVisible: "Complete project documentation"

# Filter by date
- tapOn:
    id: "date_filter"
- tapOn: "This Week"
- assertVisible: "This Week"

# Filter by session type
- tapOn:
    id: "type_filter"
- tapOn: "Work Sessions"
- assertVisible: "Work Sessions Only"

# View session details
- tapOn: "Complete project documentation"
- assertVisible: "Session Details"
- assertVisible: "Duration:"
- assertVisible: "Start Time:"
- assertVisible: "End Time:"
- assertVisible: "Task:"