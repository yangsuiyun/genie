---
appId: com.pomodoro.genie
name: Settings and Sync Flow E2E Tests
tags:
  - settings
  - sync
  - preferences

---
# Test: User Preferences
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to settings screen
- tapOn: "Settings"
- assertVisible: "Settings"

# Check user profile section
- assertVisible: "Profile"
- assertVisible: "test@example.com"

# Test theme settings
- tapOn: "Appearance"
- assertVisible: "Theme Settings"
- tapOn: "Dark Mode"
- wait: 1000
# App should switch to dark theme (visual check)
- tapOn: "Light Mode"
- wait: 1000
# App should switch back to light theme

# Test timer preferences
- tapOn:
    id: "back_button"
- tapOn: "Timer Settings"
- assertVisible: "Timer Preferences"

# Modify default work duration
- tapOn: "Default Work Duration"
- clearText:
    id: "duration_input"
- inputText: "30"
- tapOn: "Save"
- assertVisible: "Settings saved"

# Modify break durations
- tapOn: "Default Short Break"
- clearText:
    id: "duration_input"
- inputText: "7"
- tapOn: "Save"

- tapOn: "Default Long Break"
- clearText:
    id: "duration_input"
- inputText: "20"
- tapOn: "Save"

# Test auto-start settings
- tapOn: "Auto-start breaks"
- assertVisible: "Enabled"
- tapOn: "Auto-start breaks" # Toggle off
- assertVisible: "Disabled"

---
# Test: Notification Settings
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to notification settings
- tapOn: "Settings"
- tapOn: "Notifications"
- assertVisible: "Notification Settings"

# Test push notification toggle
- assertVisible: "Push Notifications"
- tapOn:
    id: "push_notifications_toggle"

# Test session notifications
- assertVisible: "Session Complete"
- tapOn:
    id: "session_complete_toggle"

- assertVisible: "Break Reminders"
- tapOn:
    id: "break_reminder_toggle"

# Test task reminder notifications
- assertVisible: "Task Reminders"
- tapOn:
    id: "task_reminder_toggle"

# Test notification sound settings
- tapOn: "Notification Sound"
- assertVisible: "Choose Sound"
- tapOn: "Bell"
- tapOn: "Save"

# Test quiet hours
- tapOn: "Quiet Hours"
- assertVisible: "Do Not Disturb"
- tapOn:
    id: "quiet_hours_toggle"
- tapOn:
    id: "start_time_picker"
- tapOn: "22:00"
- tapOn: "OK"
- tapOn:
    id: "end_time_picker"
- tapOn: "08:00"
- tapOn: "OK"
- tapOn: "Save"

---
# Test: Data Sync Settings
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to sync settings
- tapOn: "Settings"
- tapOn: "Sync & Backup"
- assertVisible: "Data Synchronization"

# Check sync status
- assertVisible: "Last Sync:"
- assertVisible: "Auto Sync"

# Test manual sync
- tapOn: "Sync Now"
- assertVisible: "Syncing..."
- wait: 3000
- assertVisible: "Sync completed"

# Test auto-sync settings
- tapOn:
    id: "auto_sync_toggle"
- assertVisible: "Auto Sync Disabled"
- tapOn:
    id: "auto_sync_toggle"
- assertVisible: "Auto Sync Enabled"

# Test sync frequency
- tapOn: "Sync Frequency"
- assertVisible: "Choose Frequency"
- tapOn: "Every 15 minutes"
- tapOn: "Save"

# Test offline mode
- tapOn: "Offline Mode"
- assertVisible: "Work Offline"
- tapOn:
    id: "offline_mode_toggle"
- assertVisible: "Offline mode enabled"

---
# Test: Account Management
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to account settings
- tapOn: "Settings"
- tapOn: "Account"
- assertVisible: "Account Settings"

# Test profile editing
- tapOn: "Edit Profile"
- assertVisible: "Edit Profile"

# Change display name
- clearText:
    id: "name_field"
- inputText: "Updated Test User"
- tapOn: "Save"
- assertVisible: "Profile updated"

# Test password change
- tapOn: "Change Password"
- assertVisible: "Change Password"
- tapOn:
    id: "current_password_field"
- inputText: "currentpassword"
- tapOn:
    id: "new_password_field"
- inputText: "newpassword123"
- tapOn:
    id: "confirm_password_field"
- inputText: "newpassword123"
- tapOn: "Update Password"
- assertVisible: "Password updated successfully"

# Test email change
- tapOn: "Change Email"
- assertVisible: "Change Email"
- tapOn:
    id: "new_email_field"
- inputText: "newemail@example.com"
- tapOn:
    id: "password_field"
- inputText: "newpassword123"
- tapOn: "Update Email"
- assertVisible: "Verification email sent"

---
# Test: Data Export and Backup
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to data management
- tapOn: "Settings"
- tapOn: "Data & Privacy"
- assertVisible: "Data Management"

# Test data export
- tapOn: "Export Data"
- assertVisible: "Export Your Data"
- assertVisible: "Tasks"
- assertVisible: "Pomodoro Sessions"
- assertVisible: "Reports"

# Select all data types
- tapOn:
    id: "select_all_checkbox"
- tapOn: "Export"
- assertVisible: "Preparing export..."
- wait: 5000
- assertVisible: "Export ready for download"

# Test backup creation
- tapOn: "Create Backup"
- assertVisible: "Creating backup..."
- wait: 3000
- assertVisible: "Backup created successfully"

# Test backup restoration
- tapOn: "Restore from Backup"
- assertVisible: "Available Backups"
- tapOn: "Latest Backup"
- assertVisible: "Restore Data"
- assertVisible: "This will replace your current data"
- tapOn: "Cancel" # Don't actually restore

---
# Test: Privacy Settings
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to privacy settings
- tapOn: "Settings"
- tapOn: "Privacy"
- assertVisible: "Privacy Settings"

# Test analytics sharing
- assertVisible: "Share Analytics"
- tapOn:
    id: "analytics_sharing_toggle"

# Test data retention settings
- tapOn: "Data Retention"
- assertVisible: "Data Retention Policy"
- tapOn: "Keep for 1 year"
- tapOn: "Save"

# Test account deletion
- tapOn: "Delete Account"
- assertVisible: "Delete Account"
- assertVisible: "This action cannot be undone"
- tapOn:
    id: "confirm_checkbox"
- tapOn: "Delete My Account"
- assertVisible: "Enter your password to confirm"
- tapOn: "Cancel" # Don't actually delete

---
# Test: Cross-Device Sync
- runFlow:
    file: shared/setup_authenticated.yaml

# Create a task on current device
- tapOn: "Tasks"
- tapOn:
    id: "add_task_fab"
- tapOn:
    id: "title_field"
- inputText: "Sync Test Task"
- tapOn: "Create Task"

# Force sync
- tapOn: "Settings"
- tapOn: "Sync & Backup"
- tapOn: "Sync Now"
- wait: 3000

# Simulate checking on another device (logout and login)
- tapOn:
    id: "back_button"
- tapOn:
    id: "back_button"
- tapOn: "Logout"
- assertVisible: "Are you sure you want to logout?"
- tapOn: "Logout"

# Login again
- assertVisible: "Welcome Back"
- tapOn:
    id: "email_field"
- inputText: "test@example.com"
- tapOn:
    id: "password_field"
- inputText: "newpassword123"
- tapOn: "Sign In"
- wait: 3000

# Check if synced task appears
- tapOn: "Tasks"
- assertVisible: "Sync Test Task"

---
# Test: App Version and Updates
- runFlow:
    file: shared/setup_authenticated.yaml

# Navigate to about section
- tapOn: "Settings"
- tapOn: "About"
- assertVisible: "About Pomodoro Genie"

# Check app version
- assertVisible: "Version"
- assertVisible: "1.0.0"

# Check for updates (if feature exists)
- tapOn: "Check for Updates"
  optional: true
- assertVisible: "Checking for updates..."
  optional: true
- wait: 2000
- assertVisible: "You have the latest version"
  optional: true

# Test feedback options
- tapOn: "Send Feedback"
- assertVisible: "Feedback"
- tapOn:
    id: "feedback_text"
- inputText: "Great app! Works perfectly."
- tapOn: "Send"
- assertVisible: "Thank you for your feedback"