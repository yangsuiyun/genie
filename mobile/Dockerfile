# ğŸ… Pomodoro Genie Frontend Dockerfile
# å¤šé˜¶æ®µæ„å»ºï¼Œä¼˜åŒ–é•œåƒå¤§å°

# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS build

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…Flutter
RUN apk add --no-cache curl unzip && \
    curl -o flutter.zip https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.24.0-stable.tar.xz && \
    unzip flutter.zip && \
    mv flutter /opt/flutter && \
    rm flutter.zip

# è®¾ç½®Flutterç¯å¢ƒå˜é‡
ENV PATH="/opt/flutter/bin:/opt/flutter/bin/cache/dart-sdk/bin:${PATH}"
ENV PUB_HOSTED_URL=https://pub.flutter-io.cn
ENV FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY mobile/ .

# è·å–ä¾èµ–
RUN flutter pub get

# æ„å»ºWebåº”ç”¨
RUN flutter build web --release --web-renderer html

# è¿è¡Œé˜¶æ®µ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=build /app/build/web /usr/share/nginx/html

# å¤åˆ¶nginxé…ç½®
COPY docker/nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨nginx
CMD ["nginx", "-g", "daemon off;"]
